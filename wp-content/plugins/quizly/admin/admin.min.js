const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;!function(e){"use strict";function t(){e(".qy-o-remove-image-button").on("click",function(t){return t.preventDefault(),e(this).hide().prev().val("").prev().addClass("button").html('<span class="dashicons dashicons-format-image"></span>'+__("Image","quiz-fox")),!1})}function o(){e(".qy-o-answer-is-correct").on("click",function(){e(this).closest(".qy-o-answers-box").find(".qy-o-answer-is-correct").each(function(){this.checked=!1}),this.checked=!0})}function n(){e(".qy-o-question-text").on("keyup",function(){e(this).closest(".qy-o-question-box").find(".qy-o-title-text").text(e(this).val())}),e(".qy-o-result-title-input").on("keyup",function(){e(this).closest(".qy-o-result-box").find(".qy-o-title-text").text(e(this).val())})}u(),t(),q(),d(),o(),n(),e(".qy-o-question-box, .qy-o-result-box","#wpbody").unbind("click"),e(".qy-o-question-box").on("click",function(t){let o=e(t.target).hasClass(".qy-o-delete-question-button");0!=i||o||(e(".qy-o-question-inside").not(e(this).find(".qy-o-question-inside")).hide(),e(this).find(".qy-o-question-inside").toggle("fast"))}),e("#wpbody").on("click",".qy-o-result-box",function(t){let o=e(t.target).hasClass("qy-o-delete-result-button");0!=i||o||(e(".qy-o-result-inside").not(e(this).find(".qy-o-result-inside")).hide(),e(this).find(".qy-o-result-inside").toggle("fast"))}),c(),e("#qy-o-main-tab").on("click",function(){e(".nav-tab-active").removeClass("nav-tab-active"),e(this).addClass("nav-tab-active").blur(),e("#qy_o_quiz_extras_meta_box").hide(),e("#qy_o_quiz_setup_meta_box, #qy_o_quiz_questions_meta_box, #qy_o_quiz_results_meta_box").show()}),e("#qy-o-extras-tab").on("click",function(){e(".nav-tab-active").removeClass("nav-tab-active"),e(this).addClass("nav-tab-active").blur(),e("#qy_o_quiz_setup_meta_box, #qy_o_quiz_questions_meta_box, #qy_o_quiz_results_meta_box").hide(),e("#qy_o_quiz_extras_meta_box").show()}),e("#publish").on("click",function(t){t.preventDefault();let o=[];e(".qy-o-question-box").each(function(){let t=[];e(this).find(".qy-o-answer-box").each(function(){t.push({text:e(this).find(".qy-o-answer-text").val(),image:e(this).find(".qy-o-answer-image-field").val(),is_correct:e(this).find(".qy-o-answer-is-correct").prop("checked"),weight:e(this).find(".qy-o-answer-weight").val(),number:e(this).find(".qy-o-answer-number").val()})}),o.push({text:e(this).find(".qy-o-question-text").val(),image:e(this).find(".qy-o-question-image-field").val(),use_image_bkg:e(this).find(".qy-o-use-image-bkg").prop("checked"),number:e(this).find(".qy-o-question-number").val(),answers:t,explanation:e(this).find(".qy-o-answer-explanation").val(),bg_color:e(this).find(".qy-o-question-bg-color").val(),text_color:e(this).find(".qy-o-question-text-color").val()})}),e("#qy_o_questions_json").val(JSON.stringify(o));let n=[];e(".qy-o-result-box").each(function(){n.push({score_range_from:e(this).find(".qy-o-result-score-from").val(),score_range_to:e(this).find(".qy-o-result-score-to").val(),title:e(this).find(".qy-o-result-title-input").val(),description:e(this).find(".qy-o-result-description").val(),image:e(this).find(".qy-o-result-image-field").val(),number:e(this).find(".qy-o-result-number").val()})}),e("#qy_o_results_json").val(JSON.stringify(n)),e("#publish").unbind("click"),e("#publish").trigger("click")}),e(".qy_o_add_answer_btn").on("click",function(n){n.preventDefault();let i=e(this).closest(".qy-o-question-box"),s=i.find(".qy-o-last-answer-number"),l=(parseInt(s.val())+1).toString();s.val(l);let d=i.find(".qy-o-answers-box .widefat tbody"),y=e("#qy-o-question-1 .qy-o-answer-1").clone().attr("class","qy-o-answer-box qy-o-answer-"+l);y.find(".qy-o-remove-image-button").hide().prev().val("").prev().addClass("button").html('<span class="dashicons dashicons-format-image"></span>'+__("Image","quiz-fox")),y.find(".qy-o-answer-text").attr("name","qy-o-answer-text-"+l).val(""),y.find(".qy-o-answer-is-correct").attr("name","qy-o-answer-is-correct-"+l).prop("checked",!1),y.find(".qy-o-answer-weight").attr("name","qy-o-answer-weight-"+l).val("1"),y.find(".qy-o-answer-number").val(l),y.appendTo(d),q(),r(),o(),a(i),u(),t(),c()}),e(".qy_o_add_question_btn").on("click",function(i){i.preventDefault();let a=e(this).closest("#qy_o_quiz_questions_meta_box").find("#qy-o-last-question-number"),l=(parseInt(a.val())+1).toString();a.val(l);let r=e(this).closest("#qy_o_quiz_questions_meta_box .inside").find("#qy-o-quiz-questions-box"),d=e("#qy-o-question-1").clone(!0);d.find(".qy-o-question-number").val(l);let y="qy-o-question-"+l;d.attr("id",y),d.find(".qy-o-question-title .qy-o-number").text(l),d.find(".qy-o-question-title .qy-o-title-text").text(""),d.find(".qy-o-remove-image-button").hide().prev().val("").prev().addClass("button").html('<span class="dashicons dashicons-format-image"></span>'+__("Image","quiz-fox")),d.find(".qy-o-question-text").attr("name","quiz_question_"+l),d.find(".qy-o-question-text").val(""),d.find(".qy-o-answer-explanation").val(""),d.find(".qy-o-last-answer-number").val("2"),d.find(".bg-color-row").remove(),d.find(".text-color-row").remove();let f='<tr class="bg-color-row"><th>'+__("Background color","quiz-fox")+'</th><td><input class="qy-o-color qy-o-question-bg-color qy-o-question-bg-color-'+l+'" type="text" name="qy_o_question_bg_color" value="#ffffff" data-default-color="#ffffff" /></td></tr>',b='<tr class="text-color-row"><th>'+__("Text color","quiz-fox")+'</th><td><input class="qy-o-color qy-o-question-text-color qy-o-question-text-color-'+l+'" type="text" name="qy_o_question_text_color" value="#222222" data-default-color="#222222" /></td></tr>';d.find(".qy-o-metabox-table .qy-o-question-body").append(f),d.find(".bg-color-row").after(b),d.find(".qy-o-question-bg-color-"+l).wpColorPicker(),d.find(".qy-o-question-text-color-"+l).wpColorPicker(),d.find(".qy-o-use-image-bkg").prop("checked",!1);let _=0;var h;d.find(".qy-o-answer-box").each(function(){++_>2?e(this).remove():(e(this).find(".qy-o-answer-text").val(""),e(this).find(".qy-o-answer-is-correct").prop("checked",!1),e(this).find(".qy-o-answer-weight").val("1"))}),r.find(".qy-o-last-answer-number").val("2"),d.appendTo(r),q(),s(),o(),u(),t(),n(),h=d,e(".qy-o-question-inside").not(h.find(".qy-o-question-inside")).hide(),h.find(".qy-o-question-inside").show("fast"),c()}),e("#qy_o_quiz_results_meta_box").on("click",".qy_o_add_result_btn",function(o){o.preventDefault();let i=e(this).closest("#qy_o_quiz_results_meta_box").find("#qy-o-last-result-number"),s=(parseInt(i.val())+1).toString();i.val(s);let a=e(this).closest("#qy_o_quiz_results_meta_box .inside").find("#qy-o-quiz-results-box"),r=e("#qy-o-result-1").clone();var q;r.find(".qy-o-result-number").val(s),r.attr("id","qy-o-result-"+s),r.find(".qy-o-remove-image-button").hide().prev().val("").prev().addClass("button").html('<span class="dashicons dashicons-format-image"></span>'+__("Image","quiz-fox")),r.find(".qy-o-result-description").attr("name","quiz_result_"+s),r.find(".qy-o-result-description").val(""),r.find(".qy-o-result-score-from").val(""),r.find(".qy-o-result-score-to").val(""),r.find(".qy-o-result-title-input").val(""),r.find(".qy-o-title-text").text(""),r.appendTo(a),d(),l(),c(),n(),u(),t(),q=r,e(".qy-o-result-inside").not(q.find(".qy-o-result-inside")).hide(),q.find(".qy-o-result-inside").show("fast"),c()}),e(".qy-o-delete-question-button").on("click",function(){let t=e(".qy-o-question-box").length;if(t>1){let o=e(this).closest(".qy-o-question-box"),n=o.find(".qy-o-question-number").val();o.remove(),e("#qy-o-last-question-number").val(t-1);let i,a=parseInt(e("#qy-o-last-question-number").val());for(i=a;i>n;i--){let t=e("#qy-o-question-"+i.toString());new_val=i-1,new_val=new_val.toString(),t.find(".qy-o-question-number").val(new_val),t.attr("id","qy-o-question-"+new_val)}let l=a-1;l=l.toString(),e("#qy-o-last-question-number").val(l),s()}else alert(__("There must be at least one question.","quizly"))}),e("#qy-o-weighted-score-enabled").change(function(){if(this.checked)e(".qy-o-answer-is-correct").addClass("qy-o-hidden"),e(".qy-o-answer-weight").removeClass("qy-o-hidden"),e("#option-answer-explanations-enabled").addClass("qy-o-hidden"),e(".explanation-box").removeClass("qy-o-row-visible");else{e(".qy-o-answer-weight").addClass("qy-o-hidden"),e(".qy-o-answer-is-correct").removeClass("qy-o-hidden"),e("#option-answer-explanations-enabled").removeClass("qy-o-hidden"),e("#qy-o-answer-explanations-enabled").prop("checked")&&e(".explanation-box").addClass("qy-o-row-visible")}}),e("#qy-o-answer-explanations-enabled").change(function(){this.checked?(e(".explanation-box").addClass("qy-o-row-visible"),r()):e(".explanation-box").removeClass("qy-o-row-visible")}),e("#qy-o-newsletter-enabled").change(function(){this.checked?e(".qy-o-newsletter-details").addClass("qy-o-row-visible"):e(".qy-o-newsletter-details").removeClass("qy-o-row-visible")}),e(".qy-o-use-image-bkg").change(function(){let t=e(this).closest(".qy-o-question-setup-box").find(".bg-color-row, .text-color-row");this.checked?t.addClass("qy-o-hidden"):t.removeClass("qy-o-hidden")}),e("#qy-o-quiz-questions-box").find(".qy-o-question-box").each(function(){let t=e(this).find(".qy-o-question-number").val();e(this).find(".qy-o-question-bg-color-"+t).wpColorPicker(),e(this).find(".qy-o-question-text-color-"+t).wpColorPicker()}),e("#qy-o-download-emails").on("click",function(t){t.preventDefault(),e.get({url:qy_o_ajax_url_csv,data:{},success:function(e){var t=document.createElement("a");t.href=e.url,t.download=e.basename,document.body.append(t),t.click(),t.remove(),window.URL.revokeObjectURL(e)},error:function(e){console.log(e)}})});let i=!1;function s(){let t=0;e(".qy-o-question-box").each(function(){t++,e(this).find(".qy-o-question-number").val(t.toString()),e(this).find(".qy-o-number").html(t+":"),e(this).attr("id","qy-o-question-"+t),1===t&&e(this).attr("id","qy-o-question-1")}),e("#qy-o-last-question-number").val(t)}function a(t){let o=0;t.find(".qy-o-answer-box").each(function(){o++,e(this).find(".qy-o-answer-number").val(o.toString()),1===o&&(e(this).removeClass(),e(this).addClass("qy-o-answer-box qy-o-answer-1"))}),t.find(".qy-o-last-answer-number").val(o)}function l(){let t=0;e(".qy-o-result-box").each(function(){t++,e(this).find(".qy-o-result-number").val(t.toString()),e(this).attr("id","qy-o-result-"+t),1===t&&e(this).attr("id","qy-o-result-1")}),e("#qy-o-last-result-number").val(t)}function r(){e(".qy-o-answers-box").each(function(){let t=e(this).find(".qy-o-answer-box").last();e(this).find(".explanation-box").insertAfter(t)})}function u(){e(".qy_o_add_image_button").unbind("click"),e(".qy_o_add_image_button").on("click",function(t){t.preventDefault();let o=t.target,n=o.closest(".qy_o_add_image_button"),i=wp.media.frames.file_frame=wp.media({title:__("Select image","quizly"),library:{type:"image"},multiple:!1,button:{text:__("Use this image","quizly")}});i.on("select",function(){let t,o,s=i.state().get("selection").first().toJSON();n.classList.contains("larger")?(t=s.sizes.medium.url,o='<img class="true_pre_image" src="'+t+'" style="max-width:200px;display:block;" />'):(t=s.sizes.thumbnail.url,o='<img class="true_pre_image" src="'+t+'" style="max-width:100px;display:block;" />');let a=s.id,l=e(n).next();e(n).removeClass("button"),e(n).html("").html(o),l.val(a),l.next().show()}).open(),t.stopPropagation()})}function q(){e(".qy-o-delete-answer-button").unbind("click"),e(".qy-o-delete-answer-button").on("click",function(){let t=e(this).closest(".qy-o-question-box");t.find(".qy-o-answer-box").length<3?alert(__("You need at least two answers.","quizly")):(e(this).closest(".qy-o-answer-box").remove(),a(t))})}function d(){e(".qy-o-delete-result-button").unbind("click"),e(".qy-o-delete-result-button").on("click",function(){if(e(".qy-o-result-box").length>1){let t=e(this).closest(".qy-o-result-box"),o=t.find(".qy-o-result-number").val();t.remove();let n,i=parseInt(e("#qy-o-last-result-number").val());for(n=i;n>o;n--){let t=e("#qy-o-result-"+n.toString());new_val=n-1,new_val=new_val.toString(),t.find(".qy-o-result-number").val(new_val),t.attr("id","qy-o-result-"+new_val)}let s=i-1;s=s.toString(),e("#qy-o-last-result-number").val(s),l()}else alert(__("There must be at least one result.","quizly"))})}function c(){e(".qy-o-question-inside, .qy-o-result-inside, .qy-o-delete-question-button, .qy-o-delete-result-button, .qy_o_add_image_button, .qy-o-result-box input, .qy-o-result-box textarea").click(function(e){e.stopPropagation()})}e("#qy-o-quiz-questions-box, #qy-o-quiz-results-box").sortable({cancel:"input, textarea, button",revert:!0,cursor:"move",scroll:!0,delay:100,start:function(){i=!0},stop:function(){i=!1}}),e("#qy-o-quiz-questions-box").unbind("sortupdate"),e("#qy-o-quiz-questions-box").on("sortupdate",function(e,t){s()}),e("#qy-o-quiz-results-box").unbind("sortupdate"),e("#qy-o-quiz-results-box").on("sortupdate",function(e,t){l()})}(jQuery);